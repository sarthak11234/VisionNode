# ===========================================================================
# SheetAgent — CI Pipeline
# ===========================================================================
# Runs on every push and PR to main.
# Two parallel jobs: lint the frontend, lint the backend.
# We'll add test jobs as we write tests in Phase 7.
#
# WHY GITHUB ACTIONS?
#   - Free for public repos, generous limits for private.
#   - Native GitHub integration (PR checks, status badges).
#   - Alternative: GitLab CI, CircleCI — both solid, but GH Actions has the
#     largest ecosystem of reusable actions.
# ===========================================================================

name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  # ── Frontend Lint & Type Check ───────────────────────
  client-lint:
    name: Client — Lint & Type Check
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./client
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: "npm"
          cache-dependency-path: client/package-lock.json

      - run: npm ci
      - run: npx next lint
      - run: npx tsc --noEmit

  # ── Backend Lint ─────────────────────────────────────
  server-lint:
    name: Server — Lint
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./server
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
          cache: "pip"

      - run: pip install ruff
      - run: ruff check app/
      - run: ruff format --check app/
